<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div style="padding:20px; background:#111;">
        <h2>Admin Panel</h2>
        <button onclick="logout()" style="width:100px; background:#e53935;">Logout</button>
    </div>

    <div class="grid">
        <div class="card">
            <h3>Create New Conference</h3>
            <input type="text" id="m-title" placeholder="Conference Title">
            <input type="text" id="m-desc" placeholder="Description">
            <button onclick="createMeeting()">Schedule</button>
        </div>
        <div id="admin-list" style="width:100%;"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script>
        checkAuth('admin'); // Security Check

        function createMeeting() {
            const title = document.getElementById('m-title').value;
            const desc = document.getElementById('m-desc').value;
            const roomId = "room_" + Date.now();
            
            db.collection('meetings').add({
                title: title, desc: desc, roomId: roomId, active: false
            }).then(() => location.reload());
        }

        db.collection('meetings').get().then(snap => {
            const list = document.getElementById('admin-list');
            snap.forEach(doc => {
                const data = doc.data();
                list.innerHTML += `
                    <div class="meeting-card" style="margin-top:10px;">
                        <h4>${data.title}</h4>
                        <button onclick="toggleActive('${doc.id}', ${!data.active})">${data.active ? 'Stop Meeting' : 'Start Meeting'}</button>
                        <button onclick="window.location.href='conference.html?room=${data.roomId}'" style="background:green;">Enter Room</button>
                    </div>
                `;
            });
        });

        function toggleActive(id, status) {
            db.collection('meetings').doc(id).update({active: status}).then(()=>location.reload());
        }
    </script>
</body>
</html>
