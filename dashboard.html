<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="dashboard-container">
        <header style="display:flex; justify-content:space-between; align-items:center;">
            <h1>Upcoming Conferences</h1>
            <button onclick="logout()" style="width:auto; background:#d32f2f;">Logout</button>
        </header>

        <div id="meetings-list" class="meeting-grid"></div>

        <h2 style="margin-top:40px;">Register for Next MUN</h2>
        <div class="card" style="width: 100%; text-align: left;">
            <form action="https://formspree.io/f/your_form_id" method="POST">
                <label>Your Name:</label>
                <input type="text" name="name" required>
                <label>Email:</label>
                <input type="email" name="email" required>
                <label>Preferred Committee:</label>
                <select name="committee">
                    <option>UNSC</option>
                    <option>DISEC</option>
                    <option>UNHRC</option>
                </select>
                <button type="submit">Submit Application</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="config.js"></script>

    <script>
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Load Meetings
        db.collection('meetings').get().then((snapshot) => {
            const list = document.getElementById('meetings-list');
            snapshot.forEach(doc => {
                const data = doc.data();
                const div = document.createElement('div');
                div.className = 'meeting-card';
                div.innerHTML = `
                    <h3>${data.title}</h3>
                    <p>Date: ${data.date}</p>
                    <p>${data.description}</p>
                    ${data.active ? `<button onclick="joinRoom('${data.roomId}')">Join Conference Room</button>` : '<p style="color:grey;">Not started yet</p>'}
                `;
                list.appendChild(div);
            });
        });

        function joinRoom(roomId) {
            window.location.href = `room.html?room=${roomId}&role=attendee`;
        }

        function logout() {
            auth.signOut().then(() => window.location.href = "index.html");
        }
    </script>
</body>
</html>
