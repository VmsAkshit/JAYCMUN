<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div style="padding:20px; display:flex; justify-content:space-between;">
        <h2>Upcoming MUNs</h2>
        <button onclick="logout()" style="width:100px; background:#e53935;">Logout</button>
    </div>

    <div id="muns-list" class="grid"></div>

    <div class="container" style="min-height:50vh;">
        <div class="card" style="width:90%; max-width:500px; text-align:left;">
            <h3>Register for MUN</h3>
            <form action="https://formspree.io/f/xqeezjdv" method="POST">
                <input type="text" name="name" placeholder="Full Name" required>
                <input type="email" name="email" placeholder="Email" required>
                <select name="committee">
                    <option>UNSC</option>
                    <option>UNHRC</option>
                    <option>DISEC</option>
                </select>
                <button type="submit">Send Application</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="config.js"></script>
    <script src="auth.js"></script>
    
    <script>
        checkAuth('user'); // Security Check ensuring only logged-in users see this
        
        // Fetch meetings from Firebase
        db.collection('meetings').get().then(snap => {
            const container = document.getElementById('muns-list');
            snap.forEach(doc => {
                const data = doc.data();
                container.innerHTML += `
                    <div class="meeting-card">
                        <h3>${data.title}</h3>
                        <p>${data.desc}</p>
                        ${data.active ? `<button onclick="window.location.href='conference.html?room=${data.roomId}'">JOIN CONFERENCE</button>` : '<p style="color:gray">Not Started</p>'}
                    </div>
                `;
            });
        });
    </script>
</body>
</html>
